<!DOCTYPE HTML>
<head>
    <title>Something fancy</title>
    <link rel = "stylesheet" type = "text/css" href = "level.css" />
</head>
<body>
  <h3>Arrow keys to move, and space to jump</h3>
    <canvas id="canvas"></canvas>
    <script>
    (function() {
      var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
      window.requestAnimationFrame = requestAnimationFrame;
  })();

  var canvas = document.getElementById("canvas"),
      ctx = canvas.getContext("2d"),
      width = 500,
      height = 300,
      player = {
        x : width/2,
        y : height - 5,
        width : 5,
        height : 5,
        speed: 3,
        velX: 0,
        velY: 0,
        jumping: false,
        //added grounded function
        grounded:false,
      },
      keys = [],
      friction = 0.8,
      gravity = 0.2;
  boxes = [];
  boxes.push({
    x: 0,
    y: 0,
    width: 10,
    height: height
});
boxes.push({
    x: 0,
    y: height - 2,
    width: width,
    height: 50
});
boxes.push({
    x:width -10,
    y:0,
    width:50,
    height:height
})
boxes.push({
    x: 70,
    y: 250,
    width: 50,
    height: 30
});
boxes.push({
  x: 110,
  y: 225,
  width: 20,
  height: 40
});
boxes.push({
  x: 120,
  y: 225,
  width: 70,
  height: 20
});
boxes.push({
  x: 205,
  y: 200,
  width: 50,
  height: 30
});
boxes.push({
  x: 250,
  y: 210,
  width: 20,
  height: 10
});
boxes.push({
  x: 280,
  y: 230,
  width: 50,
  height: 15
});
  canvas.width = width;
  canvas.height = height;


  function update(){
    // check keys

    //changed jumping key
      if (keys[38] || keys[32]) {
          // up arrow or space
        if(!player.jumping && player.grounded){
         player.jumping = true;
         player.grounded = false;//if jumping we are not on the ground anymore..:) stat 10:49:)
         player.velY = -player.speed*2;
        }
      }
      if (keys[39]) {
          // right arrow
          if (player.velX < player.speed) {
              player.velX++;
           }
      }
      if (keys[37]) {
          // left arrow
          if (player.velX > -player.speed) {
              player.velX--;
          }
      }

      player.velX *= friction;
      player.velY += gravity;

      ctx.clearRect(0,0,width,height);
      ctx.fillStyle = 'orange';

      player.grounded = false
      for (var i = 0; i<boxes.length; i++){
          //draws boxes
          ctx.rect(boxes[i].x, boxes[i].y, boxes[i].width, boxes[i].height)
          //checks for collision
          var dir = colCheck(player, boxes[i]);
          //sets jumping/grounded based on collision info
          if (dir ==='l' || dir === 'r'){
              player.velX = 0; //stops player from moving in that direction
              player.jumping = false;
          }else if (dir === 'b'){
              player.jumping = false;
              player.grounded = true;
          }else if (dir === 't'){
              player.velY *= -1; //points player in other direction
          }
      }
    // deleted previos player.x +=... this will ensure that if grounded player will have no y veocity
        if(player.grounded){
          player.velY = 0;
        }
        player.x += player.velX;
        player.y += player.velY;

        ctx.fill();
        ctx.fillStyle = "red";
        ctx.fillRect(player.x, player.y, player.width, player.height);
        console.log('hello')

        requestAnimationFrame(update);
  }

  function colCheck(shapeA, shapeB){
    //gets vectors to check if object is colliding
    var vX = (shapeA.x +(shapeA.width/2)) - (shapeB.x + (shapeB.width/2));
        vY = (shapeA.x +(shapeA.width/2)) - (shapeB.x + (shapeB.width/2));
    //gets half of height and half of width to check against vectors
        hheight =  (shapeA.height/2) + (shapeB.height/2);
        hwidth = (shapeA.width/2) + (shapeB.width/2);
        colDir = null;

        // if the x and y vector are less than the half width or half height, they we must be inside the object, causing a collision
        if (Math.abs(vX) < hwidth && Math.abs(vY) < hheight) {         // figures out on which side we are colliding (top, bottom, left, or right)         var oX = hWidths - Math.abs(vX),             oY = hHeights - Math.abs(vY);         if (oX >= oY) {
                if (vY > 0) {
                    colDir = "t";
                } else {
                    colDir = "b";
                }
            } else {
                if (vX > 0) {
                    colDir = "l";
                } else {
                    colDir = "r";
                }
            }
        return colDir;
    }

  document.body.addEventListener("keydown", function(e) {
      keys[e.keyCode] = true;
  });

  document.body.addEventListener("keyup", function(e) {
      keys[e.keyCode] = false;
  });

  window.addEventListener("load",function(){
      update();
  });
    </script>
</body>
