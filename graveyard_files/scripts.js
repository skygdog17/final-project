var wp={settings:{ajaxUrl:'/ajax/',cdnAjaxUrl:'//cdn.wallpapersafari.com/ajax/',menuLink:$('.header_menu'),searchBlock:$('.search_menu'),searchField:$('.qtext'),copyModal:$('#copy'),htmlCodeModal:$('#htmlcode'),loginModal:$('#join'),loginForm:$('#loginForm'),registerForm:$('#registerForm'),recoverForm:$('#recoverForm'),resetPasswordForm:$('#resetPasswordForm'),userSettingsForm:$('#userSettingsForm'),loginBtn:$('#loginForm button'),registerBtn:$('#registerForm button'),recoverBtn:$('#recoverForm button'),resetPasswordBtn:$('#resetPasswordForm button'),userSettingsSaveBtn:$('#userSettingsSaveBtn'),userSettingsResetBtn:$('#userSettingsResetBtn'),likeImageBtn:$('.like-image'),downloadImageBtn:$('.download-image'),avatarPreview:$('#avatarPreview'),registerLink:$('.header_join'),loginLink:$('.user-login'),htmlCodeLink:$('.htmlcode-modal'),copyLink:$('.copy-modal'),recoverLink:$('.user-recover'),avatarUploadInfo:$('.avatar-upload-info'),userSettingsInfo:$('.user-settings-info'),resetPasswordInfo:$('.reset-password-info'),likeIcon:'<i class="fa fa-heart-o"></i>',likedIcon:'<i class="fa fa-heart"></i>',spinnerIcon:'<i class="fa fa-spinner fa-spin"></i>',affixItem:$('.aff'),loadingOptions:{color:'rgba(255, 255, 255, 0.2)',image:'/img/loading.gif',size:'75%'},},loggedIn:u.u_i,likedQuoteIds:{},likedImageIds:{},init:function(){s=this.settings;if($.isArray(u.l_i)){for(i in u.l_i){this.likedImageIds[u.l_i[i]]='liked';}}
this.bindUIActions();this.initImageButtons();this.initAffix();},bindUIActions:function(){s.htmlCodeLink.on('click',function(e){e.preventDefault();var dataSource=$(e.target).attr('data-source');var dataTitle=$(e.target).attr('data-title');var dataImage=$(e.target).attr('data-image');wp.openHtmlCodeModal(dataSource,dataTitle,dataImage);});s.copyLink.on('click',function(e){e.preventDefault();var dataSource=$(e.target).attr('data-source');wp.openCopyModal(dataSource);});s.menuLink.on('click',function(e){e.preventDefault();wp.toggleMenu();});s.loginLink.on('click',function(e){e.preventDefault();wp.openLoginModal();});s.loginBtn.on('click',function(e){e.preventDefault();wp.loginAjax();});s.loginForm.keypress(function(e){if(e.which==13){e.preventDefault();e.stopPropagation();wp.loginAjax();}});s.registerLink.on('click',function(e){e.preventDefault();wp.openRegisterModal();});s.registerBtn.on('click',function(e){e.preventDefault();wp.registerAjax();});s.registerForm.keypress(function(e){if(e.which==13){e.preventDefault();e.stopPropagation();wp.registerAjax();}});s.recoverLink.on('click',function(e){e.preventDefault();wp.openRecoverModal();});s.recoverBtn.on('click',function(e){e.preventDefault();wp.recoverAjax();});s.recoverForm.keypress(function(e){if(e.which==13){e.preventDefault();e.stopPropagation();wp.recoverAjax();}});s.resetPasswordBtn.on('click',function(e){e.preventDefault();wp.resetPasswordAjax();});s.resetPasswordForm.keypress(function(e){if(e.which==13){e.preventDefault();e.stopPropagation();wp.resetPasswordAjax();}});},initImageButtons:function(){s.likeImageBtn.each(function(){var imgId=$(this).attr('data-id');var icon=wp.getLikeIcon(wp.likedImageIds,imgId);var likes=$(this).attr('data-likes');$(this).html(icon+' '+ likes);});s.likeImageBtn.on('click',function(e){e.preventDefault();if(wp.loggedIn){wp.likeImage($(this));}else{wp.openRegisterModal();}});s.downloadImageBtn.on('click',function(e){e.preventDefault();window.location='/download/'+ $(this).attr('data-id2');});},lazyLoad:function(){var bLazy=new Blazy({offset:100,success:function(element){setTimeout(function(){var parent=element.parentNode;parent.className=parent.className.replace(/\bloading\b/,'');},200);},error:function(ele,msg){if(msg==='missing'){}else if(msg==='invalid'){}}});},toggleMenu:function(){if(s.searchBlock.hasClass('search_menu_shown')){s.searchBlock.removeClass('search_menu_shown');$('body').removeClass('no_overflow');s.menuLink.removeClass('icon-cancel').addClass('icon-search-1');}
else{s.searchBlock.addClass('search_menu_shown');$('body').addClass('no_overflow');s.menuLink.removeClass('icon-search-1').addClass('icon-cancel');s.searchField.focus();}},initAffix:function(){s.affixItem.affix({offset:{top:100,bottom:function(){return(this.bottom=$('.relprefooter').outerHeight(true)+ $('.footer').outerHeight(true))}}})},submitForm:function(url,container,form,doReload,callback){$.ajax({url:url,method:form.attr('method'),data:form.serialize(),dataType:'json',headers:{'X-Requested-With':'XMLHttpRequest'},xhrFields:{withCredentials:true},success:function(response,textStatus,jqXHR){if(typeof callback==='function'){callback();}
if(response['success']){if(typeof callback==='object'&&typeof callback.success==='function'){callback.success();}
if(response['message']){wp.displaySuccess(container,response['message']);}
if(doReload===true){location.reload(true);}else if(doReload!==false){setTimeout(function(){window.location.href=doReload;},3000);}}else if(response['error']){if(typeof callback==='object'&&typeof callback.error==='function'){callback.error();}
wp.displayError(container,response['error']);}else{if(typeof callback==='object'&&typeof callback.error==='function'){callback.error();}
wp.displayError(container,'Unknown error');}},error:function(jqXHR,textStatus,e){if(typeof callback==='function'){callback();}else if(typeof callback==='object'&&typeof callback.error==='function'){callback.error();}
try{var response=jQuery.parseJSON(jqXHR.responseText);}catch(e){}
if(typeof response!=='undefined'&&response.error){error=response.error;}else{error='Unknown error';}
wp.displayError(container,error);}});},showRegisterForm:function(){s.loginForm.fadeOut('fast',function(){s.recoverForm.fadeOut('fast',function(){s.registerForm.fadeIn('fast');});});s.loginModal.find('.success').removeClass('alert alert-success').html('');s.loginModal.find('.error').removeClass('alert alert-danger').html('');},showLoginForm:function(){s.registerForm.fadeOut('fast',function(){s.recoverForm.fadeOut('fast',function(){s.loginForm.fadeIn('fast');});});s.loginModal.find('.success').removeClass('alert alert-success').html('');s.loginModal.find('.error').removeClass('alert alert-danger').html('');},showRecoverForm:function(){s.loginForm.fadeOut('fast',function(){s.registerForm.fadeOut('fast',function(){s.recoverForm.fadeIn('fast');});});s.loginModal.find('.success').removeClass('alert alert-success').html('');s.loginModal.find('.error').removeClass('alert alert-danger').html('');},openHtmlCodeModal:function(dataSource,dataTitle,dataImage){setTimeout(function(){s.htmlCodeModal.modal('show');},230);htmlCode='<p><a href="'+ dataSource+'"><img src="'+ dataImage+'" alt="'+ dataTitle+'" /></a><br /><a href="https://wallpapersafari.com/">wallpapersafari.com</a></p>';$('.htmlcode-textarea').text(htmlCode);},openCopyModal:function(dataSource){setTimeout(function(){s.copyModal.modal('show');},230);$('.btn-source').attr('href',dataSource);},openLoginModal:function(){wp.showLoginForm();setTimeout(function(){s.loginModal.modal('show');},230);},openRegisterModal:function(){wp.showRegisterForm();setTimeout(function(){s.loginModal.modal('show');},230);},openRecoverModal:function(){wp.showRecoverForm();setTimeout(function(){s.loginModal.modal('show');},230);},loginAjax:function(){wp.clearInfo();s.loginBtn.prop('disabled',true);wp.submitForm(s.ajaxUrl,s.loginModal,s.loginForm,true,function(){s.loginBtn.prop('disabled',false);});},registerAjax:function(){wp.clearInfo();s.registerBtn.prop('disabled',true);wp.submitForm(s.ajaxUrl,s.loginModal,s.registerForm,true,function(){s.registerBtn.prop('disabled',false);});},recoverAjax:function(){wp.clearInfo();s.recoverBtn.prop('disabled',true);wp.submitForm(s.ajaxUrl,s.loginModal,s.recoverForm,false,function(){s.recoverForm.find('input[type="text"]').val('');s.recoverBtn.prop('disabled',false);});},userSettingsAjax:function(){wp.clearInfo(s.userSettingsInfo);s.userSettingsSaveBtn.prop('disabled',true);s.userSettingsResetBtn.prop('disabled',true);wp.submitForm(s.ajaxUrl,s.userSettingsInfo,s.userSettingsForm,true,function(){s.userSettingsSaveBtn.prop('disabled',false);s.userSettingsResetBtn.prop('disabled',false);});},resetPasswordAjax:function(){wp.clearInfo(s.resetPasswordInfo);s.resetPasswordBtn.prop('disabled',true);wp.submitForm(s.ajaxUrl,s.resetPasswordInfo,s.resetPasswordForm,'/',function(){s.resetPasswordBtn.prop('disabled',false);});},displaySuccess:function(container,msg){if(container){container.find('.success').addClass('alert alert-success').html(msg);}},displayError:function(container,msg){if(container){container.find('.error').addClass('alert alert-danger').html(msg);s.loginModal.find('input[type="password"]').val('');}},clearInfo:function(container){var success=$('.success');var error=$('.error');if(container){success=container.find('.success');error=container.find('.error');}
success.removeClass('alert alert-success').html('');error.removeClass('alert alert-danger').html('');},changeLikeState:function(state,obj,id,likes,btn){switch(state){case'liked':case'pending':obj[id]=state;break;case'unliked':if(typeof obj[id]!=='undefined'){delete obj[id];}
break;}
btn.each(function(){if($(this).attr('data-id')==id){var icon=wp.getLikeIcon(obj,id);$(this).html(icon+' '+ likes);$(this).attr('data-likes',likes);}});},getLikeIcon:function(obj,id){if(typeof obj[id]!=='undefined'){switch(obj[id]){case'liked':return wp.settings.likedIcon;case'pending':return wp.settings.spinnerIcon;}}
return wp.settings.likeIcon;},likeImage:function(image){var imgId=image.attr('data-id');if(!imgId||wp.likedImageIds[imgId]==='pending'){return;}
var like=(typeof wp.likedImageIds[imgId]==='undefined');var likes=image.attr('data-likes');var action=like?'like':'unlike';wp.changeLikeState('pending',wp.likedImageIds,imgId,likes,s.likeImageBtn);$.ajax({url:s.ajaxUrl,method:'POST',data:'wp_action='+ action+'&id='+ imgId,dataType:'json',success:function(response){if(response['success']&&typeof response['likeCount']!=='undefined'){wp.changeLikeState(like?'liked':'unliked',wp.likedImageIds,imgId,response['likeCount'],s.likeImageBtn);}else{wp.changeLikeState(like?'unliked':'liked',wp.likedImageIds,imgId,likes,s.likeImageBtn);}},error:function(jqXHR,textStatus){wp.changeLikeState(like?'unliked':'liked',wp.likedImageIds,imgId,likes,s.likeImageBtn);}});}};$(document).ready(function(){wp.init();})